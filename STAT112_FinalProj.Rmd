---
title: "An Investigation into Causes of Heart Disease"
subtitle: "STAT 112 Final Project"
author: "Alexander Denzler, William Moscato, Matthew Polemeni-Hegarty, Erik Hager"
date: "10/23/2020"
output: 
  prettydoc::html_pretty: 
    theme: tactile
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE, error=TRUE, message=FALSE, warning=FALSE)
```

```{r, echo=FALSE}
library(tidyverse)
library(readr)
library(prettydoc)
library(corrplot)
library(gganimate)
library(ggimage)
library(patchwork)
```


## Introduction

This data set explores the factors that could possibly go into getting coronary heart disease. Coronary heart disease is usually caused by the buildup of plaque in the arteries, which in turn limits the blood flow to the heart. It is a disease that can be treated, but cannot be cured at this point. Due to its chronic nature, disease prevention is the most effective treatment. The indicating variables in this data set include : age, gender, whether or not the person smokes, how many cigarettes they smoke per day, whether they take blood pressure medication, if they have had a stroke, if they have diabetes, if they have hypertension, systolic and diastolic blood pressure, cholesterol, heart rate, and glucose levels. We want to look at all of these to see if they have an effect on whether the person has a risk of getting coronary heart disease, but more specifically we are most interested in whether smoking has an effect on coronary heart disease. 


```{r, echo = FALSE}
heart_disease <- read_csv("https://raw.githubusercontent.com/alexdenzler/STAT112_Final_Proj/master/framingham.csv", 
    col_types = cols(male = col_factor(levels = c("1", 
        "0")), education = col_factor(levels = c("4", 
        "3", "2", "1")), currentSmoker = col_factor(levels = c("1", 
        "0")), BPMeds = col_factor(levels = c("1", 
        "0")), prevalentStroke = col_factor(levels = c("1", 
        "0")), prevalentHyp = col_factor(levels = c("1", 
        "0")), diabetes = col_factor(levels = c("1", 
        "0")), TenYearCHD = col_factor(levels = c("1", 
        "0"))))
```

```{r, echo = FALSE}
heart_disease <- heart_disease %>% 
  rename(sex = male, hadStroke = prevalentStroke, 
         hasHyp = prevalentHyp) %>% 
  mutate(sex = ifelse(sex == 1, "M", "F"), 
         education = ifelse(education == 4, "College", 
                            ifelse(education == 3, "someC", 
                                   ifelse(education == 2, "HS", "someHS"))),
         currentSmoker = ifelse(currentSmoker == 1, "Y", "N"),
         BPMeds = ifelse(BPMeds == 1, "Y", "N"),
         hadStroke = ifelse(hadStroke == 1, "Y", "N"),
         hasHyp = ifelse(hasHyp == 1, "Y", "N"),
         diabetes = ifelse(diabetes == 1, "Y", "N"),
         TenYearCHD = ifelse(TenYearCHD == 1, "Y", "N"))
```



\



### Investigating the Data

```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = currentSmoker, fill = TenYearCHD)) +
  geom_bar() +
  labs(title = "Effect of Being a Current Smoker on CHD Risk",
       x = "Current Smoker",
       y = "Count",
       fill = "At Risk") + 
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

In this first plot, we are observing the trend between current smokers and their risk for coronary heart disease at an extremely high level. This one plot does not tell us too much, except for the fact that more current smokers are at risk of coronary heart disease, which is to be expected. The purpose of this plot is to investigate the data further.


```{r, echo = FALSE}
heart_disease$education <-
  factor(heart_disease$education, levels = c("someHS", "HS", "someC", "College", "NA"))

heart_disease %>% 
  filter(!is.na(education)) %>% 
  ggplot(aes(x = education, fill = TenYearCHD)) +
  geom_bar() +
  labs(title = "Effect of Maximum Education on CHD Risk",
       x = "Maximum Education",
       y = "Count",
       fill = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

Next, we compated education level with heart disease risk. This plot is similar to the first in that we must explore the indicator variables in order to conduct our analysis. However, it does tell an interesting story about how maximum education affects whether or not someone is at risk for coronary heart disease. This plot looks like it tells us that the lower the level of someone's maximum education, the more at risk someone is for CHD. However, when we look at the actual proportions, there is a higher proportion of college educated people who are at risk than people who have some college education or highschool education.

```{r, echo = FALSE}
heart_disease$education <-
  factor(heart_disease$education, levels = c("someHS", "HS", "someC", "College", "NA"))

heart_disease %>% 
  filter(!is.na(education)) %>% 
  ggplot(aes(x = education, fill = TenYearCHD)) +
  geom_bar(position = "fill") +
  labs(title = "Effect of Maximum Education on CHD Risk",
       x = "Maximum Education",
       y = "Proportion",
       fill = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```


```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = sex, fill = TenYearCHD)) +
  geom_bar() +
  labs(title = "Effect of Sex on CHD Risk",
       x = "Sex",
       y = "Count",
       fill = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

Next, we wanted to investigate whether sex had an effect of being at risk of coronary heart disease. This plot is a lot clearer than the education plot in terms of what it is telling us. Here, we can clearly see that not only are more men at risk for CHD, the proportion of men who are at risk is also much higher than for women.


```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = sysBP, y = diaBP, color = TenYearCHD)) +
  geom_jitter() +
  labs(title = "Effect of Systolic and Diastolic Blood Pressure on CHD Risk",
       x = "Systolic Blood Pressure",
       y = "Diastolic Blood Pressure",
       color = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

In this plot, we are looking at the effects of blood pressure levels on whether or not someone is at risk. Here, it is clear that the majority of the at risk points are towards the higher end of the plot, while the majority of the not at risk points are at the lower end of the plot. Logically, it makes sense that people with higher blood pressure are at risk for CHD, given that high blood pressure is one of the most telling signs of heart problems in general.


```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = diabetes, fill = TenYearCHD)) + 
  geom_bar(position = "dodge") +
  labs(title = "Does Diabetes Affect CHD Risk?",
       x = "Diabetes",
       y = "Count",
       fill = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

In this graph, we compare the proportions of subjects with and without heart disease between those who have diabetes and those who don't. Among those with diabetes, it appears that about one third also have heart disease, compared to about one-eighth among those who don't have diabetes. Thus, it seems as if diabetes is a decent indicator of whether or not someone will develop heart disease as well.   

```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = BMI, y = heartRate, color = TenYearCHD)) +
  geom_point() +
  facet_wrap(vars(diabetes)) +
  labs(title = "Is There a Correlation Between Heartrate and BMI?",
       x = "BMI",
       y = "Heart Rate",
       color = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

This graph displays the various BMI and heart rates of subjects with and without heart disease, divided into those with and without diabetes. As shown in the previous graph, it is clear that a majority of subjects don't have diabetes, but there is a significantly higher proportion of subjects with heart disease among the diabetic group. There doesn't appear to be much of a noticeable correlation between CHD and BMI or heart rate, other than that the majority of subjects with the highest heart rates among those without diabetes tended not to have heart disease. 

```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(x = BMI, y = glucose, color = TenYearCHD)) +
  geom_point() +
  facet_wrap(vars(diabetes)) +
  labs(title = "Is There a Correlation Between Glucose Levels and BMI?",
       x = "BMI",
       y = "Glucose Level",
       color = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```

This graph displays the various BMI and heart rates of subjects with and without heart disease, divided into those with and without diabetes. As shown in the previous two graphs, it is clear that a majority of subjects don't have diabetes, but there is a significantly higher proportion of subjects with heart disease among the diabetic group. There doesn't appear to be much of a noticeable correlation between CHD and BMI or glucose level in the non-diabetic group, but it appears that subjects with higher glucose levels in the diabetic group were more likely to have heart disease than diabetic subjects with lower glucose levels.

```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(y = totChol, x = TenYearCHD)) +
  geom_boxplot() +
  labs(title = "Boxplots of Risk versus Total Cholesterol Levels",
       x = "At Risk",
       y = "Total Cholesterol") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```


This graph shows us side by side boxplots that show total cholesterol levels split up by whether or not someone is at risk. What we see here is that the median cholesterol level for people who are at risk is only slightly higher than for people who are not at risk. We are also able to see that the difference between the 25th percentile and 75th percentile, otherwise known as the interquartile range (IQR), is roughly the same size for both people who are and aren't at risk. There are also some pretty significant outliers, which we can ignore.


```{r, echo = FALSE}
heart_disease %>% 
  ggplot(aes(y = glucose, x = TenYearCHD)) +
  geom_boxplot() +
  labs(title = "Boxplots of Risk versus Glucose Levels",
       x = "At Risk",
       y = "Glucose Level") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))
```


This plot is similar to the previous one, however it paints a much different picture. Surprisingly there seems to be a significant difference between the IQR when looking at glucose levels compared to cholesterol levels. The medians are almost the exact same however, and there are many outliers. These outliers can probably explain the larger 75th percentile of the interquartile range.


```{r, fig.width = 10, echo = FALSE}
cigsDens <- heart_disease %>% 
  ggplot(aes(x = cigsPerDay, fill = TenYearCHD)) +
  geom_density(position = "dodge", alpha = .7) +
  labs(x = "Cigarettes per Day",
       y = "Density",
       fill = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92")) 
  

cigsHeart <- heart_disease %>% 
  filter(currentSmoker == "Y") %>% 
  ggplot(aes(x = cigsPerDay, y = totChol, color = TenYearCHD)) + 
  geom_jitter(alpha = .7) + 
  labs(x = "Cigarettes per Day",
       y = "Total Cholesterol",
       color = "At Risk") +
  theme(plot.background = element_rect(fill = "grey92"), 
        legend.background = element_rect(fill = "grey92"))

cigsDens + cigsHeart + plot_annotation(title = "Effect of Number of Cigarettes per Day on Coronary Heart Disease Risk")
```

Because of the significant outliers in glucose, we decided to look at how cigarette usage affects risk of CHD, and used cholesterol levels to explain it. The plot on the left, which is our density plot, shows us that out of people who are at risk, a comparatively large number of cigarettes are smoked. There is a strange portion of the plot for people who are not at risk for CHD where a significant number of people who are not at risk smoke 20 cigarettes per day. However, when looking at the jitter plot next to it, where we are comparing cigarettes per day versus total cholesterol, there is a large portion of people who are not at risk and smoke 20 cigarettes per day that have very low cholesterol.



\
\




## Analysis

### Variable Importance
education, diabetes, glucose, cholesterol, ciggs
  why are these things important
  
### Controlled Graph

```{r}
heart_disease %>% 
  filter(diabetes == "N", glucose < 140, totChol > 125 & totChol < 200) %>% 
  ggplot(aes(x = cigsPerDay, fill = TenYearCHD)) +
  geom_density(position = "dodge", alpha = 0.7) +
  facet_wrap(~education)
  
```


## Appendix

```{r, echo=FALSE}
cardio_train <- read_delim("https://raw.githubusercontent.com/alexdenzler/STAT112_Final_Proj/master/cardio_train.csv",
    ";", escape_double = FALSE, trim_ws = TRUE)

#clean the data
cardio_train <- cardio_train %>%
  rename(sys_bp = ap_hi, dias_bp = ap_lo) %>%
  mutate(age = age/365, height = height*0.393701,
         weight = weight*2.20462, gender = ifelse(gender == 1, "F", "M"),
         smoke = ifelse(smoke == 1, "Y", "N"), alco = ifelse(alco == 1, "Y", "N"),
         active = ifelse(active == 1, "Y", "N"), cardio = ifelse(cardio == 1, "Y", "N"),
         smokeAndDrink = ifelse(smoke == "Y" & alco == "Y", "Y", "N"))
```

```{r}
cardio_train %>% 
 ggplot(aes(y = cholesterol, fill = cardio)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(values = c("red", "turquoise"))
```

```{r}
cardio_train %>% 
  filter(cholesterol == 1) %>% 
 ggplot(aes(y = gender, fill = cardio)) +
  geom_bar(position = "dodge")
```

```{r}
cardio_train %>% 
  filter(cholesterol == 1) %>% 
 ggplot(aes(y = smoke, fill = cardio)) +
  geom_bar(position = "dodge")
```
```{r}
cardio_train %>% 
  filter(cholesterol == 1) %>% 
 ggplot(aes(y = active, fill = cardio)) +
  geom_bar(position = "dodge")
```

```{r}
cardio_train %>% 
  filter(cholesterol == 1) %>% 
 ggplot(aes(y = alco, fill = cardio)) +
  geom_bar(position = "dodge")
```

```{r}
cardio_train %>% 
  filter(smokeAndDrink == "Y") %>% 
  ggplot(aes(x = smokeAndDrink, fill = cardio)) + 
  geom_bar()
```







